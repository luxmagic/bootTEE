ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 2
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"coap_port.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.coap_init,"ax",%progbits
  20              		.align	1
  21              		.p2align 2,,3
  22              		.global	coap_init
  23              		.syntax unified
  24              		.thumb
  25              		.thumb_func
  27              	coap_init:
  28              	.LFB132:
  29              		.file 1 "coapLIB/coap_port.c"
   1:coapLIB/coap_port.c **** #include "main.h"
   2:coapLIB/coap_port.c **** #include "coap.h"
   3:coapLIB/coap_port.c **** #include "uart.h"
   4:coapLIB/coap_port.c **** 
   5:coapLIB/coap_port.c **** #include <socket.h>
   6:coapLIB/coap_port.c **** #include <w5500_run.h>
   7:coapLIB/coap_port.c **** 
   8:coapLIB/coap_port.c **** #include <cipher_coap.h>
   9:coapLIB/coap_port.c **** 
  10:coapLIB/coap_port.c **** #include "coap_port.h"
  11:coapLIB/coap_port.c **** 
  12:coapLIB/coap_port.c **** #define COAP_PORT 5683
  13:coapLIB/coap_port.c **** #define SERVER_IP {192, 168, 1, 101}
  14:coapLIB/coap_port.c **** #define SERVER_PORT 5683
  15:coapLIB/coap_port.c **** 
  16:coapLIB/coap_port.c **** static uint8_t socket_id = 0;
  17:coapLIB/coap_port.c **** static uint8_t rx_buffer[COAP_MAX_PACKET_SIZE];
  18:coapLIB/coap_port.c **** static uint8_t tx_buffer[COAP_MAX_PACKET_SIZE];
  19:coapLIB/coap_port.c **** 
  20:coapLIB/coap_port.c **** extern response_msg[COAP_MAX_PACKET_SIZE];
  21:coapLIB/coap_port.c **** extern volatile bool flag_recv;
  22:coapLIB/coap_port.c **** 
  23:coapLIB/coap_port.c **** void coap_init(void)
  24:coapLIB/coap_port.c **** {
  30              		.loc 1 24 1 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		@ link register save eliminated.
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 2


  25:coapLIB/coap_port.c ****     udp_init(socket_id, COAP_PORT);
  35              		.loc 1 25 5 view .LVU1
  36 0000 41F23361 		movw	r1, #5683
  37 0004 0020     		movs	r0, #0
  38 0006 FFF7FEBF 		b	udp_init
  39              	.LVL0:
  40              		.cfi_endproc
  41              	.LFE132:
  43              		.section	.text.coap_send,"ax",%progbits
  44              		.align	1
  45              		.p2align 2,,3
  46              		.global	coap_send
  47              		.syntax unified
  48              		.thumb
  49              		.thumb_func
  51              	coap_send:
  52              	.LVL1:
  53              	.LFB133:
  26:coapLIB/coap_port.c **** }
  27:coapLIB/coap_port.c **** 
  28:coapLIB/coap_port.c **** int coap_send(const uint8_t *data, size_t len, uint8_t *dest_ip, uint16_t dest_port)
  29:coapLIB/coap_port.c **** {
  54              		.loc 1 29 1 view -0
  55              		.cfi_startproc
  56              		@ args = 0, pretend = 0, frame = 0
  57              		@ frame_needed = 0, uses_anonymous_args = 0
  30:coapLIB/coap_port.c ****     int32_t ret = sendto(socket_id, (uint8_t *)data, len, dest_ip, dest_port);
  58              		.loc 1 30 5 view .LVU3
  29:coapLIB/coap_port.c ****     int32_t ret = sendto(socket_id, (uint8_t *)data, len, dest_ip, dest_port);
  59              		.loc 1 29 1 is_stmt 0 view .LVU4
  60 0000 00B5     		push	{lr}
  61              	.LCFI0:
  62              		.cfi_def_cfa_offset 4
  63              		.cfi_offset 14, -4
  64 0002 83B0     		sub	sp, sp, #12
  65              	.LCFI1:
  66              		.cfi_def_cfa_offset 16
  67              		.loc 1 30 19 view .LVU5
  68 0004 0093     		str	r3, [sp]
  69 0006 1346     		mov	r3, r2
  70              	.LVL2:
  71              		.loc 1 30 19 view .LVU6
  72 0008 8AB2     		uxth	r2, r1
  73              	.LVL3:
  74              		.loc 1 30 19 view .LVU7
  75 000a 0146     		mov	r1, r0
  76              	.LVL4:
  77              		.loc 1 30 19 view .LVU8
  78 000c 0020     		movs	r0, #0
  79              	.LVL5:
  80              		.loc 1 30 19 view .LVU9
  81 000e FFF7FEFF 		bl	sendto
  82              	.LVL6:
  31:coapLIB/coap_port.c ****     return ret > 0 ? 0 : -1;
  83              		.loc 1 31 5 is_stmt 1 view .LVU10
  84              		.loc 1 31 24 is_stmt 0 view .LVU11
  85 0012 0028     		cmp	r0, #0
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 3


  86 0014 CCBF     		ite	gt
  87 0016 0020     		movgt	r0, #0
  88              	.LVL7:
  89              		.loc 1 31 24 view .LVU12
  90 0018 0120     		movle	r0, #1
  32:coapLIB/coap_port.c **** }
  91              		.loc 1 32 1 view .LVU13
  92 001a 4042     		rsbs	r0, r0, #0
  93 001c 03B0     		add	sp, sp, #12
  94              	.LCFI2:
  95              		.cfi_def_cfa_offset 4
  96              		@ sp needed
  97 001e 5DF804FB 		ldr	pc, [sp], #4
  98              		.cfi_endproc
  99              	.LFE133:
 101 0022 00BF     		.section	.text.coap_receive,"ax",%progbits
 102              		.align	1
 103              		.p2align 2,,3
 104              		.global	coap_receive
 105              		.syntax unified
 106              		.thumb
 107              		.thumb_func
 109              	coap_receive:
 110              	.LVL8:
 111              	.LFB134:
  33:coapLIB/coap_port.c **** 
  34:coapLIB/coap_port.c **** int coap_receive(uint8_t *data, size_t *len, uint8_t *src_ip, uint16_t *src_port)
  35:coapLIB/coap_port.c **** {
 112              		.loc 1 35 1 is_stmt 1 view -0
 113              		.cfi_startproc
 114              		@ args = 0, pretend = 0, frame = 0
 115              		@ frame_needed = 0, uses_anonymous_args = 0
  36:coapLIB/coap_port.c ****     int32_t ret = recvfrom(socket_id, data, *len, src_ip, src_port);
 116              		.loc 1 36 5 view .LVU15
  35:coapLIB/coap_port.c ****     int32_t ret = recvfrom(socket_id, data, *len, src_ip, src_port);
 117              		.loc 1 35 1 is_stmt 0 view .LVU16
 118 0000 10B5     		push	{r4, lr}
 119              	.LCFI3:
 120              		.cfi_def_cfa_offset 8
 121              		.cfi_offset 4, -8
 122              		.cfi_offset 14, -4
 123 0002 0C46     		mov	r4, r1
 124 0004 82B0     		sub	sp, sp, #8
 125              	.LCFI4:
 126              		.cfi_def_cfa_offset 16
  35:coapLIB/coap_port.c ****     int32_t ret = recvfrom(socket_id, data, *len, src_ip, src_port);
 127              		.loc 1 35 1 view .LVU17
 128 0006 0146     		mov	r1, r0
 129              	.LVL9:
  35:coapLIB/coap_port.c ****     int32_t ret = recvfrom(socket_id, data, *len, src_ip, src_port);
 130              		.loc 1 35 1 view .LVU18
 131 0008 1046     		mov	r0, r2
 132              	.LVL10:
 133              		.loc 1 36 19 view .LVU19
 134 000a 2288     		ldrh	r2, [r4]
 135              	.LVL11:
 136              		.loc 1 36 19 view .LVU20
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 4


 137 000c 0093     		str	r3, [sp]
 138 000e 0346     		mov	r3, r0
 139              	.LVL12:
 140              		.loc 1 36 19 view .LVU21
 141 0010 0020     		movs	r0, #0
 142              	.LVL13:
 143              		.loc 1 36 19 view .LVU22
 144 0012 FFF7FEFF 		bl	recvfrom
 145              	.LVL14:
  37:coapLIB/coap_port.c ****     if (ret > 0)
 146              		.loc 1 37 5 is_stmt 1 view .LVU23
 147              		.loc 1 37 8 is_stmt 0 view .LVU24
 148 0016 0028     		cmp	r0, #0
  38:coapLIB/coap_port.c ****     {
  39:coapLIB/coap_port.c ****         *len = ret;
 149              		.loc 1 39 9 is_stmt 1 view .LVU25
 150              		.loc 1 39 14 is_stmt 0 view .LVU26
 151 0018 CABF     		itet	gt
 152 001a 2060     		strgt	r0, [r4]
  40:coapLIB/coap_port.c ****         return 0;
 153              		.loc 1 40 9 is_stmt 1 view .LVU27
  41:coapLIB/coap_port.c ****     }
  42:coapLIB/coap_port.c ****     return -1;
 154              		.loc 1 42 12 is_stmt 0 view .LVU28
 155 001c 4FF0FF30 		movle	r0, #-1
 156              	.LVL15:
  40:coapLIB/coap_port.c ****         return 0;
 157              		.loc 1 40 16 view .LVU29
 158 0020 0020     		movgt	r0, #0
  43:coapLIB/coap_port.c **** }
 159              		.loc 1 43 1 view .LVU30
 160 0022 02B0     		add	sp, sp, #8
 161              	.LCFI5:
 162              		.cfi_def_cfa_offset 8
 163              		@ sp needed
 164 0024 10BD     		pop	{r4, pc}
 165              		.loc 1 43 1 view .LVU31
 166              		.cfi_endproc
 167              	.LFE134:
 169 0026 00BF     		.section	.text.coap_send_get,"ax",%progbits
 170              		.align	1
 171              		.p2align 2,,3
 172              		.global	coap_send_get
 173              		.syntax unified
 174              		.thumb
 175              		.thumb_func
 177              	coap_send_get:
 178              	.LVL16:
 179              	.LFB135:
  44:coapLIB/coap_port.c **** 
  45:coapLIB/coap_port.c **** int coap_send_get(const char *path_1, const char *path_2)
  46:coapLIB/coap_port.c **** {
 180              		.loc 1 46 1 is_stmt 1 view -0
 181              		.cfi_startproc
 182              		@ args = 0, pretend = 0, frame = 488
 183              		@ frame_needed = 0, uses_anonymous_args = 0
  47:coapLIB/coap_port.c ****     coap_packet_t packet;
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 5


 184              		.loc 1 47 5 view .LVU33
  48:coapLIB/coap_port.c ****     uint8_t buffer[COAP_MAX_PACKET_SIZE];
 185              		.loc 1 48 5 view .LVU34
  49:coapLIB/coap_port.c ****     size_t len = sizeof(buffer);
 186              		.loc 1 49 5 view .LVU35
  46:coapLIB/coap_port.c ****     coap_packet_t packet;
 187              		.loc 1 46 1 is_stmt 0 view .LVU36
 188 0000 70B5     		push	{r4, r5, r6, lr}
 189              	.LCFI6:
 190              		.cfi_def_cfa_offset 16
 191              		.cfi_offset 4, -16
 192              		.cfi_offset 5, -12
 193              		.cfi_offset 6, -8
 194              		.cfi_offset 14, -4
 195 0002 FCB0     		sub	sp, sp, #496
 196              	.LCFI7:
 197              		.cfi_def_cfa_offset 512
  50:coapLIB/coap_port.c **** 
  51:coapLIB/coap_port.c ****     // Инициализация пакета
  52:coapLIB/coap_port.c ****     memset(&packet, 0, sizeof(coap_packet_t));
 198              		.loc 1 52 5 view .LVU37
 199 0004 DC22     		movs	r2, #220
  49:coapLIB/coap_port.c **** 
 200              		.loc 1 49 12 view .LVU38
 201 0006 4FF48073 		mov	r3, #256
  46:coapLIB/coap_port.c ****     coap_packet_t packet;
 202              		.loc 1 46 1 view .LVU39
 203 000a 0546     		mov	r5, r0
 204 000c 0C46     		mov	r4, r1
 205              		.loc 1 52 5 view .LVU40
 206 000e 05A8     		add	r0, sp, #20
 207              	.LVL17:
 208              		.loc 1 52 5 view .LVU41
 209 0010 0021     		movs	r1, #0
 210              	.LVL18:
  49:coapLIB/coap_port.c **** 
 211              		.loc 1 49 12 view .LVU42
 212 0012 0393     		str	r3, [sp, #12]
 213              		.loc 1 52 5 is_stmt 1 view .LVU43
 214 0014 FFF7FEFF 		bl	memset
 215              	.LVL19:
  53:coapLIB/coap_port.c ****     packet.hdr.ver = COAP_VERSION;
 216              		.loc 1 53 5 view .LVU44
 217              		.loc 1 53 20 is_stmt 0 view .LVU45
 218 0018 0123     		movs	r3, #1
 219 001a 8DF81430 		strb	r3, [sp, #20]
  54:coapLIB/coap_port.c ****     packet.hdr.t = COAP_TYPE_CON;
 220              		.loc 1 54 5 is_stmt 1 view .LVU46
  55:coapLIB/coap_port.c ****     packet.hdr.tkl = 0; // Без токена
 221              		.loc 1 55 5 view .LVU47
  56:coapLIB/coap_port.c ****     packet.hdr.code = COAP_METHOD_GET;
 222              		.loc 1 56 5 view .LVU48
 223              		.loc 1 56 21 is_stmt 0 view .LVU49
 224 001e 8DF81730 		strb	r3, [sp, #23]
  57:coapLIB/coap_port.c ****     packet.hdr.id[0] = rand() & 0xFF;
 225              		.loc 1 57 5 is_stmt 1 view .LVU50
 226              		.loc 1 57 24 is_stmt 0 view .LVU51
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 6


 227 0022 FFF7FEFF 		bl	rand
 228              	.LVL20:
 229              		.loc 1 57 22 view .LVU52
 230 0026 8DF81800 		strb	r0, [sp, #24]
  58:coapLIB/coap_port.c ****     packet.hdr.id[1] = rand() & 0xFF;
 231              		.loc 1 58 5 is_stmt 1 view .LVU53
 232              		.loc 1 58 24 is_stmt 0 view .LVU54
 233 002a FFF7FEFF 		bl	rand
 234              	.LVL21:
  59:coapLIB/coap_port.c **** 
  60:coapLIB/coap_port.c ****     // Опция Uri-Path
  61:coapLIB/coap_port.c ****     packet.numopts = 2;
  62:coapLIB/coap_port.c ****     packet.opts[0].num = COAP_OPTION_URI_PATH;
 235              		.loc 1 62 24 view .LVU55
 236 002e 0B26     		movs	r6, #11
  61:coapLIB/coap_port.c ****     packet.opts[0].num = COAP_OPTION_URI_PATH;
 237              		.loc 1 61 20 view .LVU56
 238 0030 0223     		movs	r3, #2
  58:coapLIB/coap_port.c ****     packet.hdr.id[1] = rand() & 0xFF;
 239              		.loc 1 58 22 view .LVU57
 240 0032 8DF81900 		strb	r0, [sp, #25]
  61:coapLIB/coap_port.c ****     packet.opts[0].num = COAP_OPTION_URI_PATH;
 241              		.loc 1 61 5 is_stmt 1 view .LVU58
  63:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
  64:coapLIB/coap_port.c ****     packet.opts[0].buf.len = strlen(path_1);
 242              		.loc 1 64 30 is_stmt 0 view .LVU59
 243 0036 2846     		mov	r0, r5
  61:coapLIB/coap_port.c ****     packet.opts[0].num = COAP_OPTION_URI_PATH;
 244              		.loc 1 61 20 view .LVU60
 245 0038 8DF82430 		strb	r3, [sp, #36]
  62:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
 246              		.loc 1 62 5 is_stmt 1 view .LVU61
  62:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
 247              		.loc 1 62 24 is_stmt 0 view .LVU62
 248 003c 8DF82860 		strb	r6, [sp, #40]
  63:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
 249              		.loc 1 63 5 is_stmt 1 view .LVU63
  63:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
 250              		.loc 1 63 26 is_stmt 0 view .LVU64
 251 0040 0B95     		str	r5, [sp, #44]
 252              		.loc 1 64 5 is_stmt 1 view .LVU65
 253              		.loc 1 64 30 is_stmt 0 view .LVU66
 254 0042 FFF7FEFF 		bl	strlen
 255              	.LVL22:
 256              		.loc 1 64 28 view .LVU67
 257 0046 0C90     		str	r0, [sp, #48]
  65:coapLIB/coap_port.c ****     packet.opts[1].num = COAP_OPTION_URI_PATH;
 258              		.loc 1 65 5 is_stmt 1 view .LVU68
  66:coapLIB/coap_port.c ****     packet.opts[1].buf.p = (const uint8_t *)path_2;
  67:coapLIB/coap_port.c ****     packet.opts[1].buf.len = strlen(path_2);
 259              		.loc 1 67 30 is_stmt 0 view .LVU69
 260 0048 2046     		mov	r0, r4
  65:coapLIB/coap_port.c ****     packet.opts[1].num = COAP_OPTION_URI_PATH;
 261              		.loc 1 65 24 view .LVU70
 262 004a 8DF83460 		strb	r6, [sp, #52]
  66:coapLIB/coap_port.c ****     packet.opts[1].buf.p = (const uint8_t *)path_2;
 263              		.loc 1 66 5 is_stmt 1 view .LVU71
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 7


  66:coapLIB/coap_port.c ****     packet.opts[1].buf.p = (const uint8_t *)path_2;
 264              		.loc 1 66 26 is_stmt 0 view .LVU72
 265 004e 0E94     		str	r4, [sp, #56]
 266              		.loc 1 67 5 is_stmt 1 view .LVU73
 267              		.loc 1 67 30 is_stmt 0 view .LVU74
 268 0050 FFF7FEFF 		bl	strlen
 269              	.LVL23:
  68:coapLIB/coap_port.c **** 
  69:coapLIB/coap_port.c ****     // Сериализация
  70:coapLIB/coap_port.c ****     if (coap_build(buffer, &len, &packet) != 0)
 270              		.loc 1 70 9 view .LVU75
 271 0054 05AA     		add	r2, sp, #20
  67:coapLIB/coap_port.c **** 
 272              		.loc 1 67 28 view .LVU76
 273 0056 0F90     		str	r0, [sp, #60]
 274              		.loc 1 70 5 is_stmt 1 view .LVU77
 275              		.loc 1 70 9 is_stmt 0 view .LVU78
 276 0058 03A9     		add	r1, sp, #12
 277 005a 3CA8     		add	r0, sp, #240
 278 005c FFF7FEFF 		bl	coap_build
 279              	.LVL24:
 280              		.loc 1 70 8 view .LVU79
 281 0060 88B9     		cbnz	r0, .L11
  71:coapLIB/coap_port.c ****     {
  72:coapLIB/coap_port.c ****         return -1;
  73:coapLIB/coap_port.c ****     }
  74:coapLIB/coap_port.c **** 
  75:coapLIB/coap_port.c ****     // Отправка
  76:coapLIB/coap_port.c ****     uint8_t dest_ip[4] = SERVER_IP;
 282              		.loc 1 76 5 is_stmt 1 view .LVU80
 283              		.loc 1 76 13 is_stmt 0 view .LVU81
 284 0062 0A4B     		ldr	r3, .L13
 285 0064 0493     		str	r3, [sp, #16]
  77:coapLIB/coap_port.c ****     return coap_send(buffer, len, dest_ip, SERVER_PORT);
 286              		.loc 1 77 5 is_stmt 1 view .LVU82
 287              	.LVL25:
 288              	.LBB12:
 289              	.LBI12:
  28:coapLIB/coap_port.c **** {
 290              		.loc 1 28 5 view .LVU83
 291              	.LBB13:
  30:coapLIB/coap_port.c ****     return ret > 0 ? 0 : -1;
 292              		.loc 1 30 5 view .LVU84
  30:coapLIB/coap_port.c ****     return ret > 0 ? 0 : -1;
 293              		.loc 1 30 19 is_stmt 0 view .LVU85
 294 0066 41F23363 		movw	r3, #5683
 295 006a 0093     		str	r3, [sp]
 296 006c BDF80C20 		ldrh	r2, [sp, #12]
 297 0070 3CA9     		add	r1, sp, #240
 298              	.LVL26:
  30:coapLIB/coap_port.c ****     return ret > 0 ? 0 : -1;
 299              		.loc 1 30 19 view .LVU86
 300 0072 04AB     		add	r3, sp, #16
 301              	.LVL27:
  30:coapLIB/coap_port.c ****     return ret > 0 ? 0 : -1;
 302              		.loc 1 30 19 view .LVU87
 303 0074 FFF7FEFF 		bl	sendto
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 8


 304              	.LVL28:
  31:coapLIB/coap_port.c **** }
 305              		.loc 1 31 5 is_stmt 1 view .LVU88
  31:coapLIB/coap_port.c **** }
 306              		.loc 1 31 24 is_stmt 0 view .LVU89
 307 0078 0028     		cmp	r0, #0
 308 007a CCBF     		ite	gt
 309 007c 0020     		movgt	r0, #0
 310              	.LVL29:
  31:coapLIB/coap_port.c **** }
 311              		.loc 1 31 24 view .LVU90
 312 007e 0120     		movle	r0, #1
 313 0080 4042     		rsbs	r0, r0, #0
 314              	.LVL30:
 315              	.L9:
  31:coapLIB/coap_port.c **** }
 316              		.loc 1 31 24 view .LVU91
 317              	.LBE13:
 318              	.LBE12:
  78:coapLIB/coap_port.c **** }
 319              		.loc 1 78 1 view .LVU92
 320 0082 7CB0     		add	sp, sp, #496
 321              	.LCFI8:
 322              		.cfi_remember_state
 323              		.cfi_def_cfa_offset 16
 324              		@ sp needed
 325 0084 70BD     		pop	{r4, r5, r6, pc}
 326              	.LVL31:
 327              	.L11:
 328              	.LCFI9:
 329              		.cfi_restore_state
  72:coapLIB/coap_port.c ****     }
 330              		.loc 1 72 16 view .LVU93
 331 0086 4FF0FF30 		mov	r0, #-1
 332 008a FAE7     		b	.L9
 333              	.L14:
 334              		.align	2
 335              	.L13:
 336 008c C0A80165 		.word	1694607552
 337              		.cfi_endproc
 338              	.LFE135:
 340              		.section	.text.coap_send_put,"ax",%progbits
 341              		.align	1
 342              		.p2align 2,,3
 343              		.global	coap_send_put
 344              		.syntax unified
 345              		.thumb
 346              		.thumb_func
 348              	coap_send_put:
 349              	.LVL32:
 350              	.LFB136:
  79:coapLIB/coap_port.c **** 
  80:coapLIB/coap_port.c **** int coap_send_put(const char *path_1, const char *path_2, const uint8_t *payload, size_t payload_le
  81:coapLIB/coap_port.c **** {
 351              		.loc 1 81 1 is_stmt 1 view -0
 352              		.cfi_startproc
 353              		@ args = 0, pretend = 0, frame = 744
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 9


 354              		@ frame_needed = 0, uses_anonymous_args = 0
  82:coapLIB/coap_port.c ****     coap_packet_t packet;
 355              		.loc 1 82 5 view .LVU95
  83:coapLIB/coap_port.c ****     uint8_t buffer[COAP_MAX_PACKET_SIZE];
 356              		.loc 1 83 5 view .LVU96
  84:coapLIB/coap_port.c ****     size_t len = sizeof(buffer);
 357              		.loc 1 84 5 view .LVU97
  81:coapLIB/coap_port.c ****     coap_packet_t packet;
 358              		.loc 1 81 1 is_stmt 0 view .LVU98
 359 0000 2DE9F043 		push	{r4, r5, r6, r7, r8, r9, lr}
 360              	.LCFI10:
 361              		.cfi_def_cfa_offset 28
 362              		.cfi_offset 4, -28
 363              		.cfi_offset 5, -24
 364              		.cfi_offset 6, -20
 365              		.cfi_offset 7, -16
 366              		.cfi_offset 8, -12
 367              		.cfi_offset 9, -8
 368              		.cfi_offset 14, -4
 369 0004 ADF53D7D 		sub	sp, sp, #756
 370              	.LCFI11:
 371              		.cfi_def_cfa_offset 784
 372              		.loc 1 84 12 view .LVU99
 373 0008 4FF48078 		mov	r8, #256
  85:coapLIB/coap_port.c **** 
  86:coapLIB/coap_port.c ****     // Проверка размера payload
  87:coapLIB/coap_port.c ****     if (payload_len > COAP_MAX_PACKET_SIZE - 128)
 374              		.loc 1 87 8 view .LVU100
 375 000c 802B     		cmp	r3, #128
  84:coapLIB/coap_port.c **** 
 376              		.loc 1 84 12 view .LVU101
 377 000e CDF80880 		str	r8, [sp, #8]
 378              		.loc 1 87 5 is_stmt 1 view .LVU102
 379              		.loc 1 87 8 is_stmt 0 view .LVU103
 380 0012 50D8     		bhi	.L18
  88:coapLIB/coap_port.c ****         return -1; // Ограничение для безопасности
  89:coapLIB/coap_port.c **** 
  90:coapLIB/coap_port.c ****     // Инициализация пакета
  91:coapLIB/coap_port.c ****     memset(&packet, 0, sizeof(coap_packet_t));
 381              		.loc 1 91 5 is_stmt 1 view .LVU104
 382 0014 0646     		mov	r6, r0
 383 0016 0D46     		mov	r5, r1
 384 0018 1746     		mov	r7, r2
 385 001a 0021     		movs	r1, #0
 386              	.LVL33:
 387              		.loc 1 91 5 is_stmt 0 view .LVU105
 388 001c DC22     		movs	r2, #220
 389              	.LVL34:
 390              		.loc 1 91 5 view .LVU106
 391 001e 05A8     		add	r0, sp, #20
 392              	.LVL35:
 393              		.loc 1 91 5 view .LVU107
 394 0020 1C46     		mov	r4, r3
 395 0022 FFF7FEFF 		bl	memset
 396              	.LVL36:
  92:coapLIB/coap_port.c ****     packet.hdr.ver = COAP_VERSION;
 397              		.loc 1 92 5 is_stmt 1 view .LVU108
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 10


 398              		.loc 1 92 20 is_stmt 0 view .LVU109
 399 0026 0123     		movs	r3, #1
 400 0028 8DF81430 		strb	r3, [sp, #20]
  93:coapLIB/coap_port.c ****     packet.hdr.t = COAP_TYPE_CON;
 401              		.loc 1 93 5 is_stmt 1 view .LVU110
  94:coapLIB/coap_port.c ****     packet.hdr.tkl = 0;
 402              		.loc 1 94 5 view .LVU111
  95:coapLIB/coap_port.c ****     packet.hdr.code = COAP_METHOD_PUT;
 403              		.loc 1 95 5 view .LVU112
 404              		.loc 1 95 21 is_stmt 0 view .LVU113
 405 002c 0323     		movs	r3, #3
 406 002e 8DF81730 		strb	r3, [sp, #23]
  96:coapLIB/coap_port.c ****     packet.hdr.id[0] = rand() & 0xFF;
 407              		.loc 1 96 5 is_stmt 1 view .LVU114
 408              		.loc 1 96 24 is_stmt 0 view .LVU115
 409 0032 FFF7FEFF 		bl	rand
 410              	.LVL37:
 411              		.loc 1 96 22 view .LVU116
 412 0036 8DF81800 		strb	r0, [sp, #24]
  97:coapLIB/coap_port.c ****     packet.hdr.id[1] = rand() & 0xFF;
 413              		.loc 1 97 5 is_stmt 1 view .LVU117
 414              		.loc 1 97 24 is_stmt 0 view .LVU118
 415 003a FFF7FEFF 		bl	rand
 416              	.LVL38:
  98:coapLIB/coap_port.c **** 
  99:coapLIB/coap_port.c ****     // Опция Uri-Path
 100:coapLIB/coap_port.c ****     packet.numopts = 2;
 101:coapLIB/coap_port.c ****     packet.opts[0].num = COAP_OPTION_URI_PATH;
 417              		.loc 1 101 24 view .LVU119
 418 003e 4FF00B09 		mov	r9, #11
 100:coapLIB/coap_port.c ****     packet.opts[0].num = COAP_OPTION_URI_PATH;
 419              		.loc 1 100 20 view .LVU120
 420 0042 0223     		movs	r3, #2
  97:coapLIB/coap_port.c ****     packet.hdr.id[1] = rand() & 0xFF;
 421              		.loc 1 97 22 view .LVU121
 422 0044 8DF81900 		strb	r0, [sp, #25]
 100:coapLIB/coap_port.c ****     packet.opts[0].num = COAP_OPTION_URI_PATH;
 423              		.loc 1 100 5 is_stmt 1 view .LVU122
 102:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
 103:coapLIB/coap_port.c ****     packet.opts[0].buf.len = strlen(path_1);
 424              		.loc 1 103 30 is_stmt 0 view .LVU123
 425 0048 3046     		mov	r0, r6
 100:coapLIB/coap_port.c ****     packet.opts[0].num = COAP_OPTION_URI_PATH;
 426              		.loc 1 100 20 view .LVU124
 427 004a 8DF82430 		strb	r3, [sp, #36]
 101:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
 428              		.loc 1 101 5 is_stmt 1 view .LVU125
 102:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
 429              		.loc 1 102 5 view .LVU126
 430              		.loc 1 103 5 view .LVU127
 101:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
 431              		.loc 1 101 24 is_stmt 0 view .LVU128
 432 004e 8DF82890 		strb	r9, [sp, #40]
 102:coapLIB/coap_port.c ****     packet.opts[0].buf.p = (const uint8_t *)path_1;
 433              		.loc 1 102 26 view .LVU129
 434 0052 0B96     		str	r6, [sp, #44]
 435              		.loc 1 103 30 view .LVU130
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 11


 436 0054 FFF7FEFF 		bl	strlen
 437              	.LVL39:
 438              		.loc 1 103 28 view .LVU131
 439 0058 0C90     		str	r0, [sp, #48]
 104:coapLIB/coap_port.c ****     packet.opts[1].num = COAP_OPTION_URI_PATH;
 440              		.loc 1 104 5 is_stmt 1 view .LVU132
 105:coapLIB/coap_port.c ****     packet.opts[1].buf.p = (const uint8_t *)path_2;
 106:coapLIB/coap_port.c ****     packet.opts[1].buf.len = strlen(path_2);
 441              		.loc 1 106 30 is_stmt 0 view .LVU133
 442 005a 2846     		mov	r0, r5
 104:coapLIB/coap_port.c ****     packet.opts[1].num = COAP_OPTION_URI_PATH;
 443              		.loc 1 104 24 view .LVU134
 444 005c 8DF83490 		strb	r9, [sp, #52]
 105:coapLIB/coap_port.c ****     packet.opts[1].buf.p = (const uint8_t *)path_2;
 445              		.loc 1 105 5 is_stmt 1 view .LVU135
 105:coapLIB/coap_port.c ****     packet.opts[1].buf.p = (const uint8_t *)path_2;
 446              		.loc 1 105 26 is_stmt 0 view .LVU136
 447 0060 0E95     		str	r5, [sp, #56]
 448              		.loc 1 106 5 is_stmt 1 view .LVU137
 449              		.loc 1 106 30 is_stmt 0 view .LVU138
 450 0062 FFF7FEFF 		bl	strlen
 451              	.LVL40:
 107:coapLIB/coap_port.c **** 
 108:coapLIB/coap_port.c **** 
 109:coapLIB/coap_port.c ****     // Шифрование
 110:coapLIB/coap_port.c ****     uint8_t encrypted_payload[COAP_MAX_PACKET_SIZE];
 111:coapLIB/coap_port.c ****     size_t encrypted_len = sizeof(encrypted_payload);
 112:coapLIB/coap_port.c ****     if (encrypt_payload(payload, payload_len, encrypted_payload, &encrypted_len) != 0)
 452              		.loc 1 112 9 view .LVU139
 453 0066 2146     		mov	r1, r4
 106:coapLIB/coap_port.c **** 
 454              		.loc 1 106 28 view .LVU140
 455 0068 0F90     		str	r0, [sp, #60]
 110:coapLIB/coap_port.c ****     size_t encrypted_len = sizeof(encrypted_payload);
 456              		.loc 1 110 5 is_stmt 1 view .LVU141
 111:coapLIB/coap_port.c ****     if (encrypt_payload(payload, payload_len, encrypted_payload, &encrypted_len) != 0)
 457              		.loc 1 111 5 view .LVU142
 458              		.loc 1 112 9 is_stmt 0 view .LVU143
 459 006a 03AB     		add	r3, sp, #12
 460 006c 3846     		mov	r0, r7
 461 006e 7CAA     		add	r2, sp, #496
 111:coapLIB/coap_port.c ****     if (encrypt_payload(payload, payload_len, encrypted_payload, &encrypted_len) != 0)
 462              		.loc 1 111 12 view .LVU144
 463 0070 CDF80C80 		str	r8, [sp, #12]
 464              		.loc 1 112 5 is_stmt 1 view .LVU145
 465              		.loc 1 112 9 is_stmt 0 view .LVU146
 466 0074 FFF7FEFF 		bl	encrypt_payload
 467              	.LVL41:
 468              		.loc 1 112 8 view .LVU147
 469 0078 E8B9     		cbnz	r0, .L18
 113:coapLIB/coap_port.c ****         return -1;
 114:coapLIB/coap_port.c ****     // uint8_t encrypted[COAP_MAX_PACKET_SIZE];
 115:coapLIB/coap_port.c ****     // uint8_t hmac[32];
 116:coapLIB/coap_port.c ****     // size_t encrypted_len, hmac_len;
 117:coapLIB/coap_port.c ****     // if (encrypt_message(buffer, len, encrypted, &encrypted_len) != 0)
 118:coapLIB/coap_port.c ****     //     return -1;
 119:coapLIB/coap_port.c ****     // if (compute_hmac(encrypted, encrypted_len, hmac, &hmac_len) != 0)
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 12


 120:coapLIB/coap_port.c ****     //     return -1;
 121:coapLIB/coap_port.c **** 
 122:coapLIB/coap_port.c **** 
 123:coapLIB/coap_port.c ****     // Payload
 124:coapLIB/coap_port.c ****     packet.payload.p = encrypted_payload;
 470              		.loc 1 124 5 is_stmt 1 view .LVU148
 125:coapLIB/coap_port.c ****     packet.payload.len = encrypted_len;
 471              		.loc 1 125 24 is_stmt 0 view .LVU149
 472 007a 039B     		ldr	r3, [sp, #12]
 124:coapLIB/coap_port.c ****     packet.payload.len = encrypted_len;
 473              		.loc 1 124 22 view .LVU150
 474 007c 7CAA     		add	r2, sp, #496
 475              		.loc 1 125 24 view .LVU151
 476 007e CDE93A23 		strd	r2, r3, [sp, #232]
 126:coapLIB/coap_port.c **** 
 127:coapLIB/coap_port.c ****     // Сериализация
 128:coapLIB/coap_port.c ****     if (coap_build(buffer, &len, &packet) != 0)
 477              		.loc 1 128 5 is_stmt 1 view .LVU152
 478              		.loc 1 128 9 is_stmt 0 view .LVU153
 479 0082 02A9     		add	r1, sp, #8
 480 0084 05AA     		add	r2, sp, #20
 481 0086 3CA8     		add	r0, sp, #240
 482 0088 FFF7FEFF 		bl	coap_build
 483              	.LVL42:
 484              		.loc 1 128 8 view .LVU154
 485 008c 98B9     		cbnz	r0, .L18
 129:coapLIB/coap_port.c ****     {
 130:coapLIB/coap_port.c ****         return -1;
 131:coapLIB/coap_port.c ****     }
 132:coapLIB/coap_port.c **** 
 133:coapLIB/coap_port.c ****     // Отправка
 134:coapLIB/coap_port.c ****     uint8_t dest_ip[4] = SERVER_IP;
 486              		.loc 1 134 5 is_stmt 1 view .LVU155
 487              		.loc 1 134 13 is_stmt 0 view .LVU156
 488 008e 0B4B     		ldr	r3, .L20
 489 0090 0493     		str	r3, [sp, #16]
 135:coapLIB/coap_port.c ****     return coap_send(buffer, len, dest_ip, SERVER_PORT);
 490              		.loc 1 135 5 is_stmt 1 view .LVU157
 491              	.LVL43:
 492              	.LBB14:
 493              	.LBI14:
  28:coapLIB/coap_port.c **** {
 494              		.loc 1 28 5 view .LVU158
 495              	.LBB15:
  30:coapLIB/coap_port.c ****     return ret > 0 ? 0 : -1;
 496              		.loc 1 30 5 view .LVU159
  30:coapLIB/coap_port.c ****     return ret > 0 ? 0 : -1;
 497              		.loc 1 30 19 is_stmt 0 view .LVU160
 498 0092 41F23363 		movw	r3, #5683
 499 0096 0093     		str	r3, [sp]
 500 0098 BDF80820 		ldrh	r2, [sp, #8]
 501 009c 3CA9     		add	r1, sp, #240
 502              	.LVL44:
  30:coapLIB/coap_port.c ****     return ret > 0 ? 0 : -1;
 503              		.loc 1 30 19 view .LVU161
 504 009e 04AB     		add	r3, sp, #16
 505              	.LVL45:
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 13


  30:coapLIB/coap_port.c ****     return ret > 0 ? 0 : -1;
 506              		.loc 1 30 19 view .LVU162
 507 00a0 FFF7FEFF 		bl	sendto
 508              	.LVL46:
  31:coapLIB/coap_port.c **** }
 509              		.loc 1 31 5 is_stmt 1 view .LVU163
  31:coapLIB/coap_port.c **** }
 510              		.loc 1 31 24 is_stmt 0 view .LVU164
 511 00a4 0028     		cmp	r0, #0
 512 00a6 CCBF     		ite	gt
 513 00a8 0020     		movgt	r0, #0
 514              	.LVL47:
  31:coapLIB/coap_port.c **** }
 515              		.loc 1 31 24 view .LVU165
 516 00aa 0120     		movle	r0, #1
 517 00ac 4042     		rsbs	r0, r0, #0
 518              	.LVL48:
 519              	.L15:
  31:coapLIB/coap_port.c **** }
 520              		.loc 1 31 24 view .LVU166
 521              	.LBE15:
 522              	.LBE14:
 136:coapLIB/coap_port.c **** }
 523              		.loc 1 136 1 view .LVU167
 524 00ae 0DF53D7D 		add	sp, sp, #756
 525              	.LCFI12:
 526              		.cfi_remember_state
 527              		.cfi_def_cfa_offset 28
 528              		@ sp needed
 529 00b2 BDE8F083 		pop	{r4, r5, r6, r7, r8, r9, pc}
 530              	.L18:
 531              	.LCFI13:
 532              		.cfi_restore_state
  88:coapLIB/coap_port.c **** 
 533              		.loc 1 88 16 view .LVU168
 534 00b6 4FF0FF30 		mov	r0, #-1
 535 00ba F8E7     		b	.L15
 536              	.L21:
 537              		.align	2
 538              	.L20:
 539 00bc C0A80165 		.word	1694607552
 540              		.cfi_endproc
 541              	.LFE136:
 543              		.section	.text.coap_handle_response,"ax",%progbits
 544              		.align	1
 545              		.p2align 2,,3
 546              		.global	coap_handle_response
 547              		.syntax unified
 548              		.thumb
 549              		.thumb_func
 551              	coap_handle_response:
 552              	.LVL49:
 553              	.LFB137:
 137:coapLIB/coap_port.c **** 
 138:coapLIB/coap_port.c **** int coap_handle_response(uint8_t *response, size_t *response_len)
 139:coapLIB/coap_port.c **** {
 554              		.loc 1 139 1 is_stmt 1 view -0
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 14


 555              		.cfi_startproc
 556              		@ args = 0, pretend = 0, frame = 744
 557              		@ frame_needed = 0, uses_anonymous_args = 0
 140:coapLIB/coap_port.c ****     uint8_t data[COAP_MAX_PACKET_SIZE];
 558              		.loc 1 140 5 view .LVU170
 141:coapLIB/coap_port.c ****     size_t len = sizeof(data);
 559              		.loc 1 141 5 view .LVU171
 142:coapLIB/coap_port.c ****     uint8_t src_ip[4];
 560              		.loc 1 142 5 view .LVU172
 143:coapLIB/coap_port.c ****     uint16_t src_port;
 561              		.loc 1 143 5 view .LVU173
 144:coapLIB/coap_port.c **** 
 145:coapLIB/coap_port.c ****     if (coap_receive(data, &len, src_ip, &src_port) != 0)
 562              		.loc 1 145 5 view .LVU174
 139:coapLIB/coap_port.c ****     uint8_t data[COAP_MAX_PACKET_SIZE];
 563              		.loc 1 139 1 is_stmt 0 view .LVU175
 564 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 565              	.LCFI14:
 566              		.cfi_def_cfa_offset 20
 567              		.cfi_offset 4, -20
 568              		.cfi_offset 5, -16
 569              		.cfi_offset 6, -12
 570              		.cfi_offset 7, -8
 571              		.cfi_offset 14, -4
 572 0002 ADF53D7D 		sub	sp, sp, #756
 573              	.LCFI15:
 574              		.cfi_def_cfa_offset 776
 575              	.LVL50:
 576              	.LBB16:
 577              	.LBI16:
  34:coapLIB/coap_port.c **** {
 578              		.loc 1 34 5 is_stmt 1 view .LVU176
 579              	.LBB17:
  36:coapLIB/coap_port.c ****     if (ret > 0)
 580              		.loc 1 36 5 view .LVU177
  36:coapLIB/coap_port.c ****     if (ret > 0)
 581              		.loc 1 36 19 is_stmt 0 view .LVU178
 582 0006 0DF10A03 		add	r3, sp, #10
 583              	.LVL51:
  36:coapLIB/coap_port.c ****     if (ret > 0)
 584              		.loc 1 36 19 view .LVU179
 585 000a 0093     		str	r3, [sp]
 586 000c 4FF48072 		mov	r2, #256
 587 0010 03AB     		add	r3, sp, #12
 588              	.LVL52:
  36:coapLIB/coap_port.c ****     if (ret > 0)
 589              		.loc 1 36 19 view .LVU180
 590              	.LBE17:
 591              	.LBE16:
 139:coapLIB/coap_port.c ****     uint8_t data[COAP_MAX_PACKET_SIZE];
 592              		.loc 1 139 1 view .LVU181
 593 0012 0646     		mov	r6, r0
 594 0014 0D46     		mov	r5, r1
 595              	.LBB19:
 596              	.LBB18:
  36:coapLIB/coap_port.c ****     if (ret > 0)
 597              		.loc 1 36 19 view .LVU182
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 15


 598 0016 0020     		movs	r0, #0
 599              	.LVL53:
  36:coapLIB/coap_port.c ****     if (ret > 0)
 600              		.loc 1 36 19 view .LVU183
 601 0018 3CA9     		add	r1, sp, #240
 602              	.LVL54:
  36:coapLIB/coap_port.c ****     if (ret > 0)
 603              		.loc 1 36 19 view .LVU184
 604 001a FFF7FEFF 		bl	recvfrom
 605              	.LVL55:
  37:coapLIB/coap_port.c ****     {
 606              		.loc 1 37 5 is_stmt 1 view .LVU185
  37:coapLIB/coap_port.c ****     {
 607              		.loc 1 37 8 is_stmt 0 view .LVU186
 608 001e 021E     		subs	r2, r0, #0
 609 0020 22DD     		ble	.L25
  39:coapLIB/coap_port.c ****         return 0;
 610              		.loc 1 39 9 is_stmt 1 view .LVU187
 611              	.LVL56:
  40:coapLIB/coap_port.c ****     }
 612              		.loc 1 40 9 view .LVU188
  40:coapLIB/coap_port.c ****     }
 613              		.loc 1 40 9 is_stmt 0 view .LVU189
 614              	.LBE18:
 615              	.LBE19:
 146:coapLIB/coap_port.c ****     {
 147:coapLIB/coap_port.c ****         return -1;
 148:coapLIB/coap_port.c ****     }
 149:coapLIB/coap_port.c **** 
 150:coapLIB/coap_port.c ****     // Парсинг CoAP
 151:coapLIB/coap_port.c ****     coap_packet_t packet;
 616              		.loc 1 151 5 is_stmt 1 view .LVU190
 152:coapLIB/coap_port.c ****     if (coap_parse(&packet, data, len) != 0)
 617              		.loc 1 152 5 view .LVU191
 618              		.loc 1 152 9 is_stmt 0 view .LVU192
 619 0022 3CA9     		add	r1, sp, #240
 620 0024 05A8     		add	r0, sp, #20
 621              	.LVL57:
 622              		.loc 1 152 9 view .LVU193
 623 0026 FFF7FEFF 		bl	coap_parse
 624              	.LVL58:
 625              		.loc 1 152 8 view .LVU194
 626 002a E8B9     		cbnz	r0, .L25
 153:coapLIB/coap_port.c ****     {
 154:coapLIB/coap_port.c ****         return -1;
 155:coapLIB/coap_port.c ****     }
 156:coapLIB/coap_port.c **** 
 157:coapLIB/coap_port.c ****     if (packet.hdr.code != COAP_RSPCODE_CONTENT && packet.hdr.code != COAP_RSPCODE_CHANGED)
 627              		.loc 1 157 5 is_stmt 1 view .LVU195
 628              		.loc 1 157 49 is_stmt 0 view .LVU196
 629 002c 9DF81730 		ldrb	r3, [sp, #23]	@ zero_extendqisi2
 630              		.loc 1 157 8 view .LVU197
 631 0030 443B     		subs	r3, r3, #68
 632 0032 012B     		cmp	r3, #1
 633 0034 18D8     		bhi	.L25
 158:coapLIB/coap_port.c ****     {
 159:coapLIB/coap_port.c ****         return -1;
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 16


 160:coapLIB/coap_port.c ****     }
 161:coapLIB/coap_port.c **** 
 162:coapLIB/coap_port.c ****     // Проверка HMAC
 163:coapLIB/coap_port.c ****     // uint8_t encrypted[COAP_MAX_PACKET_SIZE];
 164:coapLIB/coap_port.c ****     // uint8_t hmac[32];
 165:coapLIB/coap_port.c ****     // size_t encrypted_len = data[0];
 166:coapLIB/coap_port.c ****     // if (encrypted_len > len - 33)
 167:coapLIB/coap_port.c ****     //     return -1;
 168:coapLIB/coap_port.c ****     // memcpy(encrypted, data + 1, encrypted_len);
 169:coapLIB/coap_port.c ****     // memcpy(hmac, data + 1 + encrypted_len, 32);
 170:coapLIB/coap_port.c ****     // if (verify_hmac(encrypted, encrypted_len, hmac) != 0)
 171:coapLIB/coap_port.c ****     //     return -1;
 172:coapLIB/coap_port.c **** 
 173:coapLIB/coap_port.c ****     // Дешифрование
 174:coapLIB/coap_port.c ****     uint8_t decrypted[COAP_MAX_PACKET_SIZE];
 634              		.loc 1 174 5 is_stmt 1 view .LVU198
 175:coapLIB/coap_port.c ****     size_t decrypted_len = sizeof(decrypted);
 635              		.loc 1 175 5 view .LVU199
 636              		.loc 1 175 12 is_stmt 0 view .LVU200
 637 0036 4FF48073 		mov	r3, #256
 638 003a 0493     		str	r3, [sp, #16]
 176:coapLIB/coap_port.c ****     if (decrypt_payload(packet.payload.p, packet.payload.len, decrypted, &decrypted_len) != 0)
 639              		.loc 1 176 5 is_stmt 1 view .LVU201
 640              		.loc 1 176 9 is_stmt 0 view .LVU202
 641 003c DDE93A01 		ldrd	r0, r1, [sp, #232]
 642 0040 04AB     		add	r3, sp, #16
 643 0042 7CAA     		add	r2, sp, #496
 644 0044 FFF7FEFF 		bl	decrypt_payload
 645              	.LVL59:
 646              		.loc 1 176 8 view .LVU203
 647 0048 0446     		mov	r4, r0
 648 004a 68B9     		cbnz	r0, .L25
 177:coapLIB/coap_port.c ****         return -1;
 178:coapLIB/coap_port.c **** 
 179:coapLIB/coap_port.c ****     // uart_send(decrypted, decrypted_len);
 180:coapLIB/coap_port.c **** 
 181:coapLIB/coap_port.c **** 
 182:coapLIB/coap_port.c ****     if (decrypted_len <= *response_len)
 649              		.loc 1 182 5 is_stmt 1 view .LVU204
 650              		.loc 1 182 23 is_stmt 0 view .LVU205
 651 004c 049F     		ldr	r7, [sp, #16]
 652              		.loc 1 182 8 view .LVU206
 653 004e 2B68     		ldr	r3, [r5]
 654 0050 BB42     		cmp	r3, r7
 655 0052 09D3     		bcc	.L25
 183:coapLIB/coap_port.c ****     {
 184:coapLIB/coap_port.c ****         memcpy(response, decrypted, decrypted_len);
 656              		.loc 1 184 9 is_stmt 1 view .LVU207
 657 0054 7CA9     		add	r1, sp, #496
 658 0056 3046     		mov	r0, r6
 659 0058 3A46     		mov	r2, r7
 660 005a FFF7FEFF 		bl	memcpy
 661              	.LVL60:
 185:coapLIB/coap_port.c ****         *response_len = decrypted_len;
 662              		.loc 1 185 9 view .LVU208
 186:coapLIB/coap_port.c ****         return 0;
 187:coapLIB/coap_port.c ****     }
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 17


 188:coapLIB/coap_port.c **** 
 189:coapLIB/coap_port.c ****     return -1;
 190:coapLIB/coap_port.c **** }
 663              		.loc 1 190 1 is_stmt 0 view .LVU209
 664 005e 2046     		mov	r0, r4
 185:coapLIB/coap_port.c ****         *response_len = decrypted_len;
 665              		.loc 1 185 23 view .LVU210
 666 0060 2F60     		str	r7, [r5]
 186:coapLIB/coap_port.c ****         return 0;
 667              		.loc 1 186 9 is_stmt 1 view .LVU211
 668              		.loc 1 190 1 is_stmt 0 view .LVU212
 669 0062 0DF53D7D 		add	sp, sp, #756
 670              	.LCFI16:
 671              		.cfi_remember_state
 672              		.cfi_def_cfa_offset 20
 673              		@ sp needed
 674 0066 F0BD     		pop	{r4, r5, r6, r7, pc}
 675              	.LVL61:
 676              	.L25:
 677              	.LCFI17:
 678              		.cfi_restore_state
 147:coapLIB/coap_port.c ****     }
 679              		.loc 1 147 16 view .LVU213
 680 0068 4FF0FF34 		mov	r4, #-1
 681              		.loc 1 190 1 view .LVU214
 682 006c 2046     		mov	r0, r4
 683 006e 0DF53D7D 		add	sp, sp, #756
 684              	.LCFI18:
 685              		.cfi_def_cfa_offset 20
 686              		@ sp needed
 687 0072 F0BD     		pop	{r4, r5, r6, r7, pc}
 688              		.loc 1 190 1 view .LVU215
 689              		.cfi_endproc
 690              	.LFE137:
 692              		.section	.text.EXTI1_IRQHandler,"ax",%progbits
 693              		.align	1
 694              		.p2align 2,,3
 695              		.global	EXTI1_IRQHandler
 696              		.syntax unified
 697              		.thumb
 698              		.thumb_func
 700              	EXTI1_IRQHandler:
 701              	.LFB138:
 191:coapLIB/coap_port.c **** 
 192:coapLIB/coap_port.c **** void EXTI1_IRQHandler(void)
 193:coapLIB/coap_port.c **** {
 702              		.loc 1 193 1 is_stmt 1 view -0
 703              		.cfi_startproc
 704              		@ args = 0, pretend = 0, frame = 264
 705              		@ frame_needed = 0, uses_anonymous_args = 0
 194:coapLIB/coap_port.c ****     if (EXTI->PR & EXTI_PR_PR1)
 706              		.loc 1 194 5 view .LVU217
 707              		.loc 1 194 13 is_stmt 0 view .LVU218
 708 0000 224B     		ldr	r3, .L51
 709 0002 5A69     		ldr	r2, [r3, #20]
 710              		.loc 1 194 8 view .LVU219
 711 0004 9007     		lsls	r0, r2, #30
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 18


 712 0006 00D4     		bmi	.L47
 713 0008 7047     		bx	lr
 714              	.L47:
 715              	.LBB20:
 195:coapLIB/coap_port.c ****     {
 196:coapLIB/coap_port.c ****         EXTI->PR = EXTI_PR_PR1;
 716              		.loc 1 196 9 is_stmt 1 view .LVU220
 717              	.LBE20:
 193:coapLIB/coap_port.c ****     if (EXTI->PR & EXTI_PR_PR1)
 718              		.loc 1 193 1 is_stmt 0 view .LVU221
 719 000a 10B5     		push	{r4, lr}
 720              	.LCFI19:
 721              		.cfi_def_cfa_offset 8
 722              		.cfi_offset 4, -8
 723              		.cfi_offset 14, -4
 724              	.LBB26:
 725              		.loc 1 196 18 view .LVU222
 726 000c 0222     		movs	r2, #2
 727              	.LBE26:
 193:coapLIB/coap_port.c ****     if (EXTI->PR & EXTI_PR_PR1)
 728              		.loc 1 193 1 view .LVU223
 729 000e C2B0     		sub	sp, sp, #264
 730              	.LCFI20:
 731              		.cfi_def_cfa_offset 272
 732              	.LBB27:
 733              		.loc 1 196 18 view .LVU224
 734 0010 5A61     		str	r2, [r3, #20]
 197:coapLIB/coap_port.c ****         uint8_t socket = 0;
 735              		.loc 1 197 9 is_stmt 1 view .LVU225
 736              	.LVL62:
 198:coapLIB/coap_port.c ****         uint8_t ir = getSn_IR(socket);
 737              		.loc 1 198 9 view .LVU226
 738              		.loc 1 198 22 is_stmt 0 view .LVU227
 739 0012 4FF40270 		mov	r0, #520
 740 0016 FFF7FEFF 		bl	WIZCHIP_READ
 741              	.LVL63:
 199:coapLIB/coap_port.c **** 
 200:coapLIB/coap_port.c ****         if (ir & Sn_IR_RECV)
 742              		.loc 1 200 12 view .LVU228
 743 001a 4107     		lsls	r1, r0, #29
 198:coapLIB/coap_port.c ****         uint8_t ir = getSn_IR(socket);
 744              		.loc 1 198 22 view .LVU229
 745 001c 0446     		mov	r4, r0
 746              	.LVL64:
 747              		.loc 1 200 9 is_stmt 1 view .LVU230
 748              		.loc 1 200 12 is_stmt 0 view .LVU231
 749 001e 05D4     		bmi	.L48
 750              	.LVL65:
 751              	.L30:
 201:coapLIB/coap_port.c ****         {
 202:coapLIB/coap_port.c ****             setSn_IR(socket, Sn_IR_RECV);
 203:coapLIB/coap_port.c ****             uint8_t response[COAP_MAX_PACKET_SIZE];
 204:coapLIB/coap_port.c ****             uint16_t response_len = sizeof(response);
 205:coapLIB/coap_port.c ****             if (coap_handle_response(response, &response_len) == 0)
 206:coapLIB/coap_port.c ****             {
 207:coapLIB/coap_port.c ****                 memcpy(response_msg, response, response_len);
 208:coapLIB/coap_port.c ****                 flag_recv = true;
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 19


 209:coapLIB/coap_port.c ****             }
 210:coapLIB/coap_port.c ****         }
 211:coapLIB/coap_port.c **** 
 212:coapLIB/coap_port.c ****         if (ir & Sn_IR_TIMEOUT)
 752              		.loc 1 212 9 is_stmt 1 view .LVU232
 753              		.loc 1 212 12 is_stmt 0 view .LVU233
 754 0020 2207     		lsls	r2, r4, #28
 755 0022 2DD4     		bmi	.L49
 756              	.L32:
 213:coapLIB/coap_port.c ****         {
 214:coapLIB/coap_port.c ****             setSn_IR(socket, Sn_IR_TIMEOUT);
 215:coapLIB/coap_port.c ****         }
 216:coapLIB/coap_port.c **** 
 217:coapLIB/coap_port.c ****         if (ir & Sn_IR_DISCON)
 757              		.loc 1 217 9 is_stmt 1 view .LVU234
 758              		.loc 1 217 12 is_stmt 0 view .LVU235
 759 0024 A307     		lsls	r3, r4, #30
 760 0026 1BD4     		bmi	.L50
 761              	.LBE27:
 218:coapLIB/coap_port.c ****         {
 219:coapLIB/coap_port.c ****             setSn_IR(socket, Sn_IR_DISCON);
 220:coapLIB/coap_port.c ****             disconnect(socket);
 221:coapLIB/coap_port.c ****             coap_init();
 222:coapLIB/coap_port.c ****         }
 223:coapLIB/coap_port.c ****     }
 224:coapLIB/coap_port.c **** }...
 762              		.loc 1 224 1 view .LVU236
 763 0028 42B0     		add	sp, sp, #264
 764              	.LCFI21:
 765              		.cfi_remember_state
 766              		.cfi_def_cfa_offset 8
 767              		@ sp needed
 768 002a 10BD     		pop	{r4, pc}
 769              	.LVL66:
 770              	.L48:
 771              	.LCFI22:
 772              		.cfi_restore_state
 773              	.LBB28:
 774              	.LBB21:
 202:coapLIB/coap_port.c ****             setSn_IR(socket, Sn_IR_RECV);
 775              		.loc 1 202 13 is_stmt 1 view .LVU237
 776 002c 0421     		movs	r1, #4
 777 002e 4FF40270 		mov	r0, #520
 778              	.LVL67:
 202:coapLIB/coap_port.c ****             setSn_IR(socket, Sn_IR_RECV);
 779              		.loc 1 202 13 is_stmt 0 view .LVU238
 780 0032 FFF7FEFF 		bl	WIZCHIP_WRITE
 781              	.LVL68:
 203:coapLIB/coap_port.c ****             uint8_t response[COAP_MAX_PACKET_SIZE];
 782              		.loc 1 203 13 is_stmt 1 view .LVU239
 204:coapLIB/coap_port.c ****             uint16_t response_len = sizeof(response);
 783              		.loc 1 204 13 view .LVU240
 204:coapLIB/coap_port.c ****             uint16_t response_len = sizeof(response);
 784              		.loc 1 204 22 is_stmt 0 view .LVU241
 785 0036 4FF48073 		mov	r3, #256
 205:coapLIB/coap_port.c ****             if (coap_handle_response(response, &response_len) == 0)
 786              		.loc 1 205 17 view .LVU242
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 20


 787 003a 0DF10601 		add	r1, sp, #6
 788 003e 02A8     		add	r0, sp, #8
 204:coapLIB/coap_port.c ****             uint16_t response_len = sizeof(response);
 789              		.loc 1 204 22 view .LVU243
 790 0040 ADF80630 		strh	r3, [sp, #6]	@ movhi
 205:coapLIB/coap_port.c ****             if (coap_handle_response(response, &response_len) == 0)
 791              		.loc 1 205 13 is_stmt 1 view .LVU244
 205:coapLIB/coap_port.c ****             if (coap_handle_response(response, &response_len) == 0)
 792              		.loc 1 205 17 is_stmt 0 view .LVU245
 793 0044 FFF7FEFF 		bl	coap_handle_response
 794              	.LVL69:
 205:coapLIB/coap_port.c ****             if (coap_handle_response(response, &response_len) == 0)
 795              		.loc 1 205 16 view .LVU246
 796 0048 0028     		cmp	r0, #0
 797 004a E9D1     		bne	.L30
 207:coapLIB/coap_port.c ****                 memcpy(response_msg, response, response_len);
 798              		.loc 1 207 17 is_stmt 1 view .LVU247
 799 004c BDF80620 		ldrh	r2, [sp, #6]
 800 0050 0F48     		ldr	r0, .L51+4
 801 0052 02A9     		add	r1, sp, #8
 802 0054 FFF7FEFF 		bl	memcpy
 803              	.LVL70:
 208:coapLIB/coap_port.c ****                 flag_recv = true;
 804              		.loc 1 208 17 view .LVU248
 208:coapLIB/coap_port.c ****                 flag_recv = true;
 805              		.loc 1 208 27 is_stmt 0 view .LVU249
 806 0058 0E4B     		ldr	r3, .L51+8
 807 005a 0122     		movs	r2, #1
 808 005c 1A70     		strb	r2, [r3]
 809 005e DFE7     		b	.L30
 810              	.L50:
 811              	.LBE21:
 219:coapLIB/coap_port.c ****             setSn_IR(socket, Sn_IR_DISCON);
 812              		.loc 1 219 13 is_stmt 1 view .LVU250
 813 0060 0221     		movs	r1, #2
 814 0062 4FF40270 		mov	r0, #520
 815 0066 FFF7FEFF 		bl	WIZCHIP_WRITE
 816              	.LVL71:
 220:coapLIB/coap_port.c ****             disconnect(socket);
 817              		.loc 1 220 13 view .LVU251
 818 006a 0020     		movs	r0, #0
 819 006c FFF7FEFF 		bl	disconnect
 820              	.LVL72:
 221:coapLIB/coap_port.c ****             coap_init();
 821              		.loc 1 221 13 view .LVU252
 822              	.LBB22:
 823              	.LBI22:
  23:coapLIB/coap_port.c **** void coap_init(void)
 824              		.loc 1 23 6 view .LVU253
 825              	.LBB23:
  25:coapLIB/coap_port.c ****     udp_init(socket_id, COAP_PORT);
 826              		.loc 1 25 5 view .LVU254
 827 0070 41F23361 		movw	r1, #5683
 828 0074 0020     		movs	r0, #0
 829              	.LBE23:
 830              	.LBE22:
 831              	.LBE28:
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 21


 832              		.loc 1 224 1 is_stmt 0 view .LVU255
 833 0076 42B0     		add	sp, sp, #264
 834              	.LCFI23:
 835              		.cfi_remember_state
 836              		.cfi_def_cfa_offset 8
 837              		@ sp needed
 838 0078 BDE81040 		pop	{r4, lr}
 839              	.LCFI24:
 840              		.cfi_restore 14
 841              		.cfi_restore 4
 842              		.cfi_def_cfa_offset 0
 843              	.LBB29:
 844              	.LBB25:
 845              	.LBB24:
  25:coapLIB/coap_port.c ****     udp_init(socket_id, COAP_PORT);
 846              		.loc 1 25 5 view .LVU256
 847 007c FFF7FEBF 		b	udp_init
 848              	.LVL73:
 849              	.L49:
 850              	.LCFI25:
 851              		.cfi_restore_state
 852              	.LBE24:
 853              	.LBE25:
 214:coapLIB/coap_port.c ****             setSn_IR(socket, Sn_IR_TIMEOUT);
 854              		.loc 1 214 13 is_stmt 1 view .LVU257
 855 0080 0821     		movs	r1, #8
 856 0082 4FF40270 		mov	r0, #520
 857 0086 FFF7FEFF 		bl	WIZCHIP_WRITE
 858              	.LVL74:
 859 008a CBE7     		b	.L32
 860              	.L52:
 861              		.align	2
 862              	.L51:
 863 008c 003C0140 		.word	1073822720
 864 0090 00000000 		.word	response_msg
 865 0094 00000000 		.word	flag_recv
 866              	.LBE29:
 867              		.cfi_endproc
 868              	.LFE138:
 870              		.text
 871              	.Letext0:
 872              		.file 2 "d:\\gcc arm\\10 2021.10\\arm-none-eabi\\include\\machine\\_default_types.h"
 873              		.file 3 "d:\\gcc arm\\10 2021.10\\arm-none-eabi\\include\\sys\\_stdint.h"
 874              		.file 4 "CMSIS/Device/ST/STM32F4xx/Include/stm32f401xc.h"
 875              		.file 5 "d:\\gcc arm\\10 2021.10\\lib\\gcc\\arm-none-eabi\\10.3.1\\include\\stddef.h"
 876              		.file 6 "coapLIB/coap.h"
 877              		.file 7 "ioLIB/W5500/w5500.h"
 878              		.file 8 "Core/w5500_run.h"
 879              		.file 9 "ioLIB/socket.h"
 880              		.file 10 "Core/cipher_coap.h"
 881              		.file 11 "<built-in>"
 882              		.file 12 "d:\\gcc arm\\10 2021.10\\arm-none-eabi\\include\\stdlib.h"
 883              		.file 13 "d:\\gcc arm\\10 2021.10\\arm-none-eabi\\include\\string.h"
ARM GAS  C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s 			page 22


DEFINED SYMBOLS
                            *ABS*:00000000 coap_port.c
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:20     .text.coap_init:00000000 $t
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:27     .text.coap_init:00000000 coap_init
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:44     .text.coap_send:00000000 $t
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:51     .text.coap_send:00000000 coap_send
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:102    .text.coap_receive:00000000 $t
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:109    .text.coap_receive:00000000 coap_receive
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:170    .text.coap_send_get:00000000 $t
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:177    .text.coap_send_get:00000000 coap_send_get
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:336    .text.coap_send_get:0000008c $d
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:341    .text.coap_send_put:00000000 $t
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:348    .text.coap_send_put:00000000 coap_send_put
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:539    .text.coap_send_put:000000bc $d
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:544    .text.coap_handle_response:00000000 $t
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:551    .text.coap_handle_response:00000000 coap_handle_response
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:693    .text.EXTI1_IRQHandler:00000000 $t
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:700    .text.EXTI1_IRQHandler:00000000 EXTI1_IRQHandler
C:\Users\clay0\AppData\Local\Temp\ccGs19Kk.s:863    .text.EXTI1_IRQHandler:0000008c $d

UNDEFINED SYMBOLS
udp_init
sendto
recvfrom
memset
rand
strlen
coap_build
encrypt_payload
coap_parse
decrypt_payload
memcpy
WIZCHIP_READ
WIZCHIP_WRITE
disconnect
response_msg
flag_recv
